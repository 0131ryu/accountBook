{% extends 'layout.html' %}

{% block content %}

<main>
    <div class="inner">
        <div class="jumbotron-container">
            <div class="jumbotron-item-main">
                <div class="jumbotron-item-main-message">
                    <p>ë§¤ì¼ë§¤ì¼ ìŒ“ì•„ê°€ëŠ”,</p>
                    <h2>ì˜ë‹¨ì–´ ì™¸ìš°ê¸°</h2>
                </div>
                <div class="jumbotron-item-main-image"></div>
            </div>
            <!-- jumbotron-item-main -->
            <div class="jumbotron-item-sub">
                <p>ìŠì–´ ë²„ë¦¬ê¸° ì‰¬ìš´ ì˜ë‹¨ì–´ë¥¼ </p>
                <p><span>Easy, Middle, Advance</span>ë¡œ ë¶„ë¥˜í•´ì„œ ì™¸ì›Œë´…ì‹œë‹¤</p>
            </div>
            <div class="word-finding">
                <form id="word-form" action="/word" method="get">
                    <input id="english" type="text" placeholder="ê²€ìƒ‰í•  ì˜ì–´ë‹¨ì–´ ì…ë ¥" name="english">
                    <button class="word-find-eng-btn" id="matrix-input-btn-search">ê²€ìƒ‰</button>
                </form>
                {% if words %}
                <p class="word-find-result">[ê²°ê³¼ê°’]
                    ì˜ë‹¨ì–´ : <span class="word-find-result-eng">{{word.english}}</span>
                    í•œê¸€ : <span class="word-find-result-kor">{{word.korean}}</span> ì¢…ë¥˜ : <span
                        class="word-find-result-type">{{word.type}}</span>
                </p>
                {% endif %}
            </div>
        </div>
        <!-- jumbotron-container -->
        <div class="word-counting">
            <p>ì™¸ìš´ ë‹¨ì–´ ìˆ˜ :
                {% if countAll and count %}
                <span id="word-counting-checked">{{count}}
                    {% else %}
                    <span id="word-counting-checked">0
                        {% endif %}
                    </span>
            </p>
            <p>ì´ ë‹¨ì–´ ìˆ˜ :
                {% if countAll and count %}
                <span id="word-counting-all">{{countAll}}
                    {% else %}
                    <span id="word-counting-all">0
                        {% endif %}
                    </span>
            </p>

        </div>

        <div class="matrix-container">
            <div class="check_all">
                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox" data-id=0 /> <label
                    for="checkAll">ëª¨ë“  ì²´í¬ë°•ìŠ¤
                    ì²´í¬</label>
            </div>
            <div class="matrix-item">
                <div class="matrix-item-header">
                    <div class="matrix-title">ğŸ¥‰ Easy </div>
                    <form id="word-form" action="/word/write" method="post">
                        <input id="english" type="text" placeholder="ì˜ì–´ ì…ë ¥" name="english">
                        <input id="korean" type="text" placeholder="í•œê¸€ ì…ë ¥" name="korean">
                        <input id="checkboxs" type="checkbox" placeholder="easy" name="type" value="easy">
                        <label for="easy" class="label-easy">easy</label>
                        <button class="matrix-input-btn-easy" id="matrix-input-btn" type="submit">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>

                <!-- matrix-item-header -->
                <ul class="matrix-item-list">
                    {% if user and user.id %}
                    {% for word in wordsEasy %}
                    {% if user.id === word.UserId %}
                    <li class="list-item" id="${word.wordIdx}">
                        <div class="done-text-container">
                            {% if word.status === "C" %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" checked />
                                <label for="checkitem"></label>
                            </div>
                            {% else %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" />
                                <label for="checkitem"></label>
                            </div>
                            {% endif %}
                            <p class="word-text-eng">{{word.english}}</p>
                        </div>
                        <div class="done-text-container">
                            <p class="word-text-kor">{{word.korean}}</p>
                            <p class="word-id" id="{{word.id}}">[{{word.id}}]</p>
                        </div>
                        <div class="update-delete-container">
                            <i id="word-update" class="word-update fa-solid fa-pencil" data-id="{{word.id}}"
                                onClick=`${getChangeWord(event)}`></i>
                            <i class="word-status fa-solid fa-trash-can" data-id="{{word.id}}"
                                onClick=`${getStatus(event)}` id="D"></i>
                        </div>
                    </li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                </ul>
            </div>
            <div class="matrix-item" id="middle">
                <div class="matrix-item-header">
                    <div class="matrix-title">ğŸ¥ˆ Middle </div>
                    <form id="word-form" action="/word/write" method="post">
                        <input id="english" type="text" placeholder="ì˜ì–´ ì…ë ¥" name="english">
                        <input id="korean" type="text" placeholder="í•œê¸€ ì…ë ¥" name="korean">
                        <input id="checkboxs" type="checkbox" placeholder="easy" name="type" value="middle">
                        <label for="middle">middle</label>
                        <button class="matrix-input-btn-easy" id="matrix-input-btn" type="submit">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>

                <!-- matrix-item-header -->
                <ul class="matrix-item-list">
                    {% if user and user.id %}
                    {% for word in wordsMiddle %}
                    {% if user.id === word.UserId %}
                    <li class="list-item" id="${word.wordIdx}">
                        <div class="done-text-container">
                            {% if word.status === "C" %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" checked />
                                <label for="checkitem"></label>
                            </div>
                            {% else %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" />
                                <label for="checkitem"></label>
                            </div>
                            {% endif %}
                            <p class="word-text-eng">{{word.english}}</p>
                        </div>
                        <div class="done-text-container">
                            <p class="word-text-kor">{{word.korean}}</p>
                            <p class="word-id" id="{{word.id}}">[{{word.id}}]</p>
                        </div>
                        <div class="update-delete-container">
                            <i id="word-update" class="word-update fa-solid fa-pencil" data-id="{{word.id}}"
                                onClick=`${getChangeWord(event)}`></i>
                            <i class="word-status fa-solid fa-trash-can" data-id="{{word.id}}"
                                onClick=`${getStatus(event)}` id="D"></i>
                        </div>
                    </li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                </ul>
            </div>
            <!-- matrix-item do -->
            <div class="matrix-item" id="advance">
                <div class="matrix-item-header">
                    <div class="matrix-title">ğŸ¥‡ Advance </div>
                    <form id="word-form" action="/word/write" method="post">
                        <input id="english" type="text" placeholder="ì˜ì–´ ì…ë ¥" name="english">
                        <input id="korean" type="text" placeholder="í•œê¸€ ì…ë ¥" name="korean">
                        <input id="checkboxs" type="checkbox" placeholder="easy" name="type" value="advance">
                        <label for="advance">advance</label>
                        <button class="matrix-input-btn-easy" id="matrix-input-btn" type="submit">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>
                <!-- matrix-item-header -->
                <ul class="matrix-item-list">
                    {% if user and user.id %}
                    {% for word in wordsAdvance %}
                    {% if user.id === word.UserId %}
                    <li class="list-item" id="${word.wordIdx}">
                        <div class="done-text-container">
                            {% if word.status === "C" %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" checked />
                                <label for="checkitem"></label>
                            </div>
                            {% else %}
                            <div class="check_item">
                                <input type="checkbox" class="word-status" id="checkboxStatus" name="countCheckbox"
                                    onClick=`${getStatusCheck(event)}` data-id="{{word.id}}" />
                                <label for="checkitem"></label>
                            </div>
                            {% endif %}
                            <p class="word-text-eng">{{word.english}}</p>
                        </div>
                        <div class="done-text-container">
                            <p class="word-text-kor">{{word.korean}}</p>
                            <p class="word-id" id="{{word.id}}">[{{word.id}}]</p>
                        </div>
                        <div class="update-delete-container">
                            <i id="word-update" class="word-update fa-solid fa-pencil" data-id="{{word.id}}"
                                onClick=`${getChangeWord(event)}`></i>
                            <i class="word-status fa-solid fa-trash-can" data-id="{{word.id}}"
                                onClick=`${getStatus(event)}` id="D"></i>
                        </div>
                    </li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                </ul>
            </div>

            <div class="deleted-items">
                <div class="deleted-item-list">
                    <p>ì‚­ì œí•œ ë‹¨ì–´ë“¤</p>
                    <button class="deletedWord-btn" id="D">ë‹¨ì–´ í™•ì¸í•˜ê¸°</button>
                    <button class="deletedWord-btn-close">ë‹«ê¸°</button>
                    <div class="deletedWord-result" name="deletedItems">

                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block script %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    window.onload = () => {
        if (new URL(location.href).searchParams.get('loginError')) {
            alert(new URL(location.href).searchParams.get('loginError'));
        }
    };

    //word ìˆ˜ì •
    async function getChangeWord(event) {

        const english = prompt("ìˆ˜ì •í•  ì˜ì–´ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
        const korean = prompt("ìˆ˜ì •í•  ë‹¨ì–´ ëœ»ì„ ì…ë ¥í•˜ì„¸ìš”");
        const id = event.target.dataset.id;
        console.log("id", event.target.dataset.id);

        event.preventDefault();
        // console.log(english, korean, id);

        if (!english || !korean) {
            alert("ì˜ì–´, í•œê¸€ ë‹¨ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
            return false;
        }

        try {
            await axios.put(`/word/${id}`, { english, korean });
            window.location.reload();
        } catch (err) {
            console.error(err);
        }
        english.value = '';
        korean.value = '';
    }

    //status ìˆ˜ì •(A, C, D)
    async function getStatus(event) {
        let status = "";

        if (event.target.closest(".word-status").id === "A") {
            status = "A"
        } else if (event.target.closest(".word-status").id === "D") {
            let result = confirm("ì •ë§ë¡œ ë‹¨ì–´ë¥¼ ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
            if (result === true) {
                alert("í™•ì¸ì„ ëˆŒë €ìŠµë‹ˆë‹¤.");
                status = "D";
            } else {
                alert("ì·¨ì†Œë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.");
                status = "A";
            }
        }

        const wordId = event.target.dataset.id;
        console.log("id", event.target.dataset.id);
        console.log("status", event.target.closest(".word-status").id);
        console.log("final status", status);

        event.preventDefault();

        try {
            await axios.patch(`/word/${wordId}`, { status: status });
            location.reload();
        } catch (err) {
            console.error(err);
        }
    }

    //ìˆ˜ì • - ì²´í¬ë°•ìŠ¤
    const checkboxes = document.querySelectorAll(".check_item input");
    const checkAll = document.querySelector(".check_all input");

    const agree = {
        checkitem: false
    }

    checkboxes.forEach((item) => item.addEventListener("input", toggleCheckbox));

    async function toggleCheckbox(event) {
        const { checked, id } = event.target;
        agree[id] = checked;
        this.parentNode.classList.toggle("active");
        checkAllStatus();

        const status = event.target.checked ? "C" : "A";
        const wordId = event.target.dataset.id;
        console.log("id", event.target.dataset.id);
        console.log("status", status);

        try {
            await axios.patch(`/word/${wordId}`, { status: status });
        } catch (err) {
            console.error(err);
        }

    }
    function checkAllStatus() {
        const { checkitem } = agree;
        if (checkitem) {
            checkAll.checked = true;
        } else {
            checkAll.checked = false;
        }
    }

    checkAll.addEventListener("click", (event) => {
        const { checked } = event.target;
        if (checked) {
            checkboxes.forEach((item) => {
                item.checked = true;
                agree[item.id] = true;
                item.parentNode.classList.add("active");
            })
        } else {
            checkboxes.forEach((item) => {
                item.checked = false;
                agree[item.id] = false;
                item.parentNode.classList.remove("active");
            })
        }

        const status = event.target.checked ? "C" : "A";
        const wordId = event.target.dataset.id;
        console.log("id", event.target.dataset.id);
        console.log("status", status);

        try {
            axios.patch(`/word/status/1`, { status: status });
        } catch (err) {
            console.error(err);
        }
    })

    async function getStatusCheck(event) {
        // const status = event.target.checked ? "C" : "A";
        // const wordId = event.target.dataset.id;
        // console.log("id", event.target.dataset.id);
        // console.log("status", status);

        // try {
        //     await axios.patch(`/word/${wordId}`, { status: status });
        // } catch (err) {
        //     console.error(err);
        // }
        console.log("hello");
    }
</script>
{% endblock %}